---
title: "yes_example_report"
author: "Mallory Dobias"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: no
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '5'
  word_document:
    toc: yes
    toc_depth: '5'
geometry: margin=0.50in
---

```{r setup, include=FALSE}

## Setting up R

knitr::opts_chunk$set(echo = TRUE)

if(!require(pointblank)){install.packages('pointblank')}
library(pointblank) # installing and calling pointblank package early in Markdown

validate_rmd(summary = TRUE, log_to_file = FALSE) # allowing validation from pointblank package within Markdown

```

```{r, include=FALSE}

if(!require(here)){install.packages('here')}
library(here)

if(!require(dplyr)){install.packages('dplyr')}
library(dplyr)

if(!require(stringr)){install.packages('stringr')}
library(stringr)

if(!require(tidyr)){install.packages('tidyr')}
library(tidyr)

if(!require(readr)){install.packages('readr')}
library(readr)

if(!require(tidyverse)){install.packages('tidyverse')}
library(tidyverse)

if(!require(ggridges)){install.packages('ggridges')}
library(ggridges)

if(!require(showtext)){install.packages('showtext')}
library(showtext)

if(!require(patchwork)){install.packages('patchwork')}
library(patchwork)

```

```{r reading in data, include=FALSE}

## Reading in cleaned survey data

library(here) # places working directory at root of project folder

data <- readRDS(here("data", "clean", "yes_data_nu_english_clean.Rds")) # directing to data from project folder root

# head(data) # looks good

```

```{r calculating perc complete of those who started for abc, include=FALSE}

n_started_abc <- data %>%
  filter(str_detect(ssi_choice, "A.B.C")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_abc <- data %>%
  filter(str_detect(ssi_choice, "A.B.C")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_abc <- round((n_completed_abc / n_started_abc) * 100, 2)

```

```{r calculating perc complete of those who started for care, include=FALSE}

n_started_care <- data %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_care <- data %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_care <- round((n_completed_care / n_started_care) * 100, 2)

```

```{r calculating perc complete of those who started for pp, include=FALSE}

n_started_pp <- data %>%
  filter(str_detect(ssi_choice, "Personality")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_pp <- data %>%
  filter(str_detect(ssi_choice, "Personality")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_pp <- round((n_completed_pp / n_started_pp) * 100, 2)

```

```{r calculating perc complete of those who started for rise, include=FALSE}

n_started_rise <- data %>%
  filter(str_detect(ssi_choice, "RISE")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_rise <- data %>%
  filter(str_detect(ssi_choice, "RISE")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_rise <- round((n_completed_rise / n_started_rise) * 100, 2)

```

```{r calculating perc complete of those who started any ssi, include=FALSE}

n_started_any_ssi <- data %>%
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_any_ssi <- data %>%
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_any_ssi <- round((n_completed_any_ssi / n_started_any_ssi) * 100, 2)

```

```{r calculating perc agreed to questionnaires, include=FALSE}

n_agreed_questionnaires <- data %>%
  filter(volunteer_questionnaires_yn == "Yes") %>% # filtering to those who agreed
  select(volunteer_questionnaires_yn) %>%
  tally()

n_answered_questionnaires_item <- data %>%
  filter(!is.na(volunteer_questionnaires_yn)) %>% # filtering to those who started an ssi
  select(volunteer_questionnaires_yn) %>%
  tally()

perc_agreed_questionnaires <- round((n_agreed_questionnaires / n_answered_questionnaires_item) * 100, 2)

```

# Summary

This report uses data from the largest English-speaking survey among YES data sources. The report includes examples of outcomes/results Mallory can generate for anyone interested in these data. For example, in these data to date:

+ In `r perc_completed_any_ssi`% of cases where someone started any SSI (n = `r n_started_any_ssi`), they completed it (n = `r n_completed_any_ssi`)
+ In `r perc_completed_abc`% of cases where someone started ABC (n = `r n_started_abc`), they completed it (n = `r n_completed_abc`)
+ In `r perc_completed_care`% of cases where someone started CARE (n = `r n_started_care`), they completed it (n = `r n_completed_care`)
+ In `r perc_completed_pp`% of cases where someone started Project Personality (n = `r n_started_pp`), they completed it (n = `r n_completed_pp`)
+ In `r perc_completed_rise`% of cases where someone started RISE (n = `r n_started_rise`), they completed it (n = `r n_completed_rise`)

Approximately half (`r perc_agreed_questionnaires` %) of time, people agreed to complete optional questionnaires.

# Plotting Outcomes 

```{r plot setup, include=FALSE, warning=FALSE}

## Loading required packages

library(tidyverse)
library(ggridges)
library(showtext)

## Setting up fonts

font_add_google(name = "Noto Sans",
                family = "noto sans")

showtext::showtext_auto()

```

## ABC

```{r, out.width = "260px", out.height = "250px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_abc_graphic.png")

```

Visualizing bhs scores (hopelessness) pre vs. post abc 

```{r visualizing pre-post hopelessness abc setup, include=FALSE}

## Selecting pre and post vars for abc

pre_post_bhs_abc <- data %>% 
  filter(str_detect(ssi_started, "A.B.C.")) %>%
  dplyr::select(pre_bhs_mean, post_bhs_mean)

# Converting to long data format

pre_post_bhs_abc_long <- pivot_longer(pre_post_bhs_abc, 
                                           cols = contains("mean"), 
                                           names_to = "timing", 
                                           values_to = "hopelessness")

##  Renaming for plot

plot_data_bhs_abc <- pre_post_bhs_abc_long %>% 
  mutate(timing = case_when(str_detect(timing, "pre") ~ "Before",
         str_detect(timing, "post") ~ "After",
         is.na(timing) ~ NA_character_))

```

```{r writing plot function for future plots, include=FALSE}

## Writing a function for future plot setup

process_plot_data <- function(data, ssi_string, pre_var, post_var, outcome_label) {
  # Select pre and post variables based on the ssi string
  pre_post_outcome <- data %>%
    filter(str_detect(ssi_started, ssi_string)) %>%
    dplyr::select(contains(pre_var), 
                  contains(post_var))
  
  # Convert to long data format
  pre_post_outcome_long <- pre_post_outcome %>%
    pivot_longer(cols = contains("mean"), 
                 names_to = "timing", 
                 values_to = outcome_label)
  
  # Mutate 'timing' to label pre/post as 'Before'/'After'
  plot_data <- pre_post_outcome_long %>%
    mutate(timing = case_when(
      str_detect(timing, "pre") ~ "Before",
      str_detect(timing, "post") ~ "After",
      is.na(timing) ~ NA_character_
    ))
  
  return(plot_data)
}

```

```{r running custom plot function on abc bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_abc_function <- process_plot_data(data, "A.B.C.", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r checking data frames are identical with and without function, include=FALSE}

identical(plot_data_bhs_abc, plot_data_bhs_abc_function) # true if processed data is identical using function

```

```{r visualizing pre-post bhs abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_bhs <- plot_data_bhs_abc_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post abc

```{r plotting bhs pre and post abc, warning=FALSE, message=FALSE}

plot_abc_bhs

```

Visualizing shs scores (hope-pathways subscale) pre vs. post abc 

```{r running custom plot function on abc shs data, include=FALSE}

## Running plot setup function

plot_data_shs_abc_function <- process_plot_data(data, "A.B.C.", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_shs <- plot_data_shs_abc_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hope (Pathways)", y = " ")

```

Plotting hope pre and post abc

```{r plotting shs pre and post abc, warning=FALSE, message=FALSE}

plot_abc_shs

```

Visualizing self-hate scores pre vs. post abc 

```{r running custom plot function on abc hate data, include=FALSE}

## Running plot setup function

plot_data_hate_abc_function <- process_plot_data(data, "A.B.C.", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_hate <- plot_data_hate_abc_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(1, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post abc

```{r plotting hate pre and post abc, warning=FALSE, message=FALSE}

plot_abc_hate

```

Combining all abc pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after abc; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after abc; right plot shows distributions of self-hate scores before and after abc. Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining abc pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for abc

plots_abc <- plot_abc_bhs + plot_abc_shs + plot_abc_hate +
  plot_annotation(title = "Outcomes before vs after ABC Project",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_abc

```

## Project CARE

```{r, out.width = "260px", out.height = "250px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_care_graphic.png")

```

Visualizing bhs scores (hopelessness) pre vs. post care

```{r running custom plot function on care bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_care_function <- process_plot_data(data, "C.A.R.E", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs care, include=FALSE, warning=FALSE}

## Plotting

plot_care_bhs <- plot_data_bhs_care_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post care

```{r plotting bhs pre and post care, warning=FALSE, message=FALSE}

plot_care_bhs

```

Visualizing shs scores (hope-pathways subscale) pre vs. post care 

```{r running custom plot function on care shs data, include=FALSE}

## Running plot setup function

plot_data_shs_care_function <- process_plot_data(data, "C.A.R.E", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs care, include=FALSE, warning=FALSE}

## Plotting

plot_care_shs <- plot_data_shs_care_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hope (Pathways)", y = " ")

```

Plotting hope pre and post care

```{r plotting shs pre and post care, warning=FALSE, message=FALSE}

plot_care_shs

```

Visualizing self-hate scores pre vs. post care 

```{r running custom plot function on care hate data, include=FALSE}

## Running plot setup function

plot_data_hate_care_function <- process_plot_data(data, "C.A.R.E", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate care, include=FALSE, warning=FALSE}

## Plotting

plot_care_hate <- plot_data_hate_care_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(1, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post care

```{r plotting hate pre and post care, warning=FALSE}

plot_care_hate

```

Combining all project care pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project care; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project care; right plot shows distributions of self-hate scores before and after project care. Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining care pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for care

plots_care <- plot_care_bhs + plot_care_shs + plot_care_hate +
  plot_annotation(title = "Outcomes before vs after Project CARE",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_care

```

## Project Personality

```{r, out.width = "260px", out.height = "240px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_pp_graphic.png")

```

Visualizing bhs scores (hopelessness) pre vs. post project personality 

```{r running custom plot function on pp bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_pp_function <- process_plot_data(data, "Personality", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_bhs <- plot_data_bhs_pp_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post project personality

```{r plotting bhs pre and post pp, warning=FALSE, message=FALSE}

plot_pp_bhs

```

Visualizing shs scores (hope-pathways subscale) pre vs. post project personality 

```{r running custom plot function on pp shs data, include=FALSE}

## Running plot setup function

plot_data_shs_pp_function <- process_plot_data(data, "Personality", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_shs <- plot_data_shs_pp_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hope (Pathways)", y = " ")

```

Plotting hope pre and post project personality

```{r plotting shs pre and post pp, warning=FALSE, message=FALSE}

plot_pp_shs

```

Visualizing self-hate scores pre vs. post project personality 

```{r running custom plot function on pp hate data, include=FALSE}

## Running plot setup function

plot_data_hate_pp_function <- process_plot_data(data, "Personality", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_hate <- plot_data_hate_pp_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(1, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post project personality

```{r plotting hate pre and post pp, warning=FALSE, message=FALSE}

plot_pp_hate

```

Combining all project personality pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project personality; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project personality; right plot shows distributions of self-hate scores before and after project personality Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining pp pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for pp

plots_pp <- plot_pp_bhs + plot_pp_shs + plot_pp_hate +
  plot_annotation(title = "Outcomes before vs after Project Personality",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_pp

```

## Project RISE

```{r, out.width = "260px", out.height = "240px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_rise_graphic.png")

```

Visualizing bhs scores (hopelessness) pre vs. post project rise 

```{r running custom plot function on rise bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_rise_function <- process_plot_data(data, "RISE", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_bhs <- plot_data_bhs_rise_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post project rise

```{r plotting bhs pre and post rise, warning=FALSE, message=FALSE}

plot_rise_bhs

```

Visualizing shs scores (hope-pathways subscale) pre vs. post project rise

```{r running custom plot function on rise shs data, include=FALSE}

## Running plot setup function

plot_data_shs_rise_function <- process_plot_data(data, "Personality", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_shs <- plot_data_shs_rise_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(0, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hope (Pathways)", y = " ")

```

Plotting hope pre and post project rise

```{r plotting shs pre and post rise, warning=FALSE, message=FALSE}

plot_rise_shs

```

Visualizing self-hate scores pre vs. post project rise

```{r running custom plot function on rise hate data, include=FALSE}

## Running plot setup function

plot_data_hate_rise_function <- process_plot_data(data, "Personality", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_hate <- plot_data_hate_rise_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(1, NA)) +  # Set x-axis to start at 0, leave the upper limit as default
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post project rise

```{r plotting hate pre and post rise, warning=FALSE, message=FALSE}

plot_rise_hate

```

Combining all project rise pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project rise; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project rise; right plot shows distributions of self-hate scores before and after project rise Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining rise pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for rise

plots_rise <- plot_rise_bhs + plot_rise_shs + plot_rise_hate +
  plot_annotation(title = "Outcomes before vs after Project RISE",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_rise

```

## All

```{r combining all pre post outcomes plots, warning=FALSE, message=FALSE}

library(patchwork)

# Combine the plots vertically
plots_all <- plots_abc / plots_care / plots_pp / plots_rise  + 
  plot_annotation(
    title = "Outcomes before and after all SSIs",
    caption = "Hopelessness, hope, self-hate before + after abc (green), project care (red), project personality (blue), and project rise (orange)"
  )

# Show the combined plot
plots_all

```

# Completion Rates

## ABC

Of `r n_started_abc` cases where someone started abc, `r n_completed_abc` cases completed the intervention. This results in an abc completion rate of `r perc_completed_abc`%.

```{r n started abc}

n_started_abc

```

```{r n completed abc}

n_completed_abc

```

```{r perc completed abc}

perc_completed_abc

```

## Project CARE

Of `r n_started_care` cases where someone started care, `r n_completed_care` cases completed the intervention. This results in an project care completion rate of `r perc_completed_care`%.

```{r n started care}

n_started_care

```

```{r n completed care}

n_completed_care

```

```{r perc completed care}

perc_completed_care

```

## Project Personality

Of `r n_started_pp` cases where someone started project personality, `r n_completed_pp` cases completed the intervention. This results in a project personality completion rate of `r perc_completed_pp`%.

```{r n started pp}

n_started_pp

```

```{r n completed pp}

n_completed_pp

```

```{r perc completed pp}

perc_completed_pp

```

## Project RISE

Of `r n_started_rise` cases where someone started project rise, `r n_completed_rise` cases completed the intervention. This results in a project rise completion rate of `r perc_completed_rise`%.

```{r n started rise}

n_started_rise

```

```{r n completed rise}

n_completed_rise

```

```{r perc completed rise}

perc_completed_rise

```

## All

Of `r n_started_any_ssi` cases where someone started any ssi, `r n_completed_any_ssi` cases completed the intervention. This results in an overall completion rate of `r perc_completed_any_ssi`% for any ssi.

```{r n started any ssi}

n_started_any_ssi

```

```{r n completed any ssi}

n_completed_any_ssi

```

```{r perc completed any ssi}

perc_completed_any_ssi

```