---
title: "yes_example_report"
author: "Mallory Dobias"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: no
      smooth_scroll: no
  pdf_document:
    toc: yes
    toc_depth: '5'
  word_document:
    toc: yes
    toc_depth: '5'
geometry: margin=0.50in
---

```{r setup, include=FALSE}

## Setting up R

knitr::opts_chunk$set(echo = TRUE)

if(!require(pointblank)){install.packages('pointblank')}
library(pointblank) # installing and calling pointblank package early in Markdown

validate_rmd(summary = TRUE, log_to_file = FALSE) # allowing validation from pointblank package within Markdown

```

```{r packages, include=FALSE}

## Loading packages

if(!require(here)){install.packages('here')}
library(here)

if(!require(dplyr)){install.packages('dplyr')}
library(dplyr)

if(!require(stringr)){install.packages('stringr')}
library(stringr)

if(!require(tidyr)){install.packages('tidyr')}
library(tidyr)

if(!require(readr)){install.packages('readr')}
library(readr)

if(!require(tidyverse)){install.packages('tidyverse')}
library(tidyverse)

if(!require(ggridges)){install.packages('ggridges')}
library(ggridges)

if(!require(showtext)){install.packages('showtext')}
library(showtext)

if(!require(patchwork)){install.packages('patchwork')}
library(patchwork)

if(!require(stats)){install.packages('stats')}
library(stats)

if(!require(MOTE)){install.packages('MOTE')}
library(MOTE)

```

```{r note, include=FALSE}

## The next several chunks setup the data for our analysis and 
## calculate values that are required for the summary

```

```{r reading in data, include=FALSE}

## Reading in cleaned survey data

library(here) # places working directory at root of project folder

data <- readRDS(here("data", "clean", "yes_data_nu_english_clean.Rds")) # directing to data from project folder root

# head(data) # looks good

```

```{r filtering to youth only data for analysis, include=FALSE}

## Filtering to youth only for our analysis

data_youth <- data %>%
  filter(dem_age != "18 or older")

```

```{r calculating n milestones, include=FALSE}

## Calculating n milestones

n_started_survey <- data_youth %>%
  tally() # started the survey

n_chose_any_ssi <- data_youth %>%
  filter(!is.na(ssi_choice)) %>%
  tally() # chose any ssi

n_chose_abc <- data_youth %>%
  filter(str_detect(ssi_choice, "A.B.C")) %>%
  tally() # chose abc

n_chose_care <- data_youth %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) %>%
  tally() # chose care
  
n_chose_pp <- data_youth %>%
  filter(str_detect(ssi_choice, "Personality")) %>%
  tally() # chose pp

n_chose_rise <- data_youth %>%
  filter(str_detect(ssi_choice, "RISE")) %>%
  tally() # chose pp

```

```{r calculating perc milestones, include=FALSE}

## Percent of cases who chose an ssi, of those who started the survey

perc_chose_any_ssi <- round((n_chose_any_ssi/n_started_survey)*100, 2)

## Percent of cases who chose abc, of those who chose any ssi

perc_chose_abc <- round((n_chose_abc/n_chose_any_ssi)*100, 2)

## Percent of cases who chose care, of those who chose any ssi

perc_chose_care <- round((n_chose_care/n_chose_any_ssi)*100, 2)

## Percent of cases who chose pp, of those who chose any ssi

perc_chose_pp <- round((n_chose_pp/n_chose_any_ssi)*100, 2)

## Percent of cases who chose pp, of those who chose any ssi

perc_chose_rise <- round((n_chose_rise/n_chose_any_ssi)*100, 2)

```

```{r calculating perc complete of those who started for abc, include=FALSE}

n_started_abc <- data_youth %>%
  filter(str_detect(ssi_choice, "A.B.C")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_abc <- data_youth %>%
  filter(str_detect(ssi_choice, "A.B.C")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_abc <- round((n_completed_abc / n_started_abc) * 100, 2)

```

```{r calculating perc complete of those who started for care, include=FALSE}

n_started_care <- data_youth %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_care <- data_youth %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_care <- round((n_completed_care / n_started_care) * 100, 2)

```

```{r calculating perc complete of those who started for pp, include=FALSE}

n_started_pp <- data_youth %>%
  filter(str_detect(ssi_choice, "Personality")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_pp <- data_youth %>%
  filter(str_detect(ssi_choice, "Personality")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_pp <- round((n_completed_pp / n_started_pp) * 100, 2)

```

```{r calculating perc complete of those who started for rise, include=FALSE}

n_started_rise <- data_youth %>%
  filter(str_detect(ssi_choice, "RISE")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_rise <- data_youth %>%
  filter(str_detect(ssi_choice, "RISE")) %>% # filtering to those who chose this ssi
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_rise <- round((n_completed_rise / n_started_rise) * 100, 2)

```

```{r calculating perc complete of those who started any ssi, include=FALSE}

n_started_any_ssi <- data_youth %>%
  filter(!is.na(ssi_started)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_started) %>%
  tally()

n_completed_any_ssi <- data_youth %>%
  filter(!is.na(ssi_completed)) %>% # filtering to those who started an ssi
  select(ssi_choice, ssi_completed) %>%
  tally()

perc_completed_any_ssi <- round((n_completed_any_ssi / n_started_any_ssi) * 100, 2)

```

```{r calculating perc agreed to questionnaires, include=FALSE}

n_agreed_questionnaires <- data_youth %>%
  filter(volunteer_questionnaires_yn == "Yes") %>% # filtering to those who agreed
  select(volunteer_questionnaires_yn) %>%
  tally()

n_answered_questionnaires_item <- data_youth %>%
  filter(!is.na(volunteer_questionnaires_yn)) %>% # filtering to those who started an ssi
  select(volunteer_questionnaires_yn) %>%
  tally()

perc_agreed_questionnaires <- round((n_agreed_questionnaires / n_answered_questionnaires_item) * 100, 2)

```

```{r calculating aggregated pfs mean overall, include=FALSE}

## Calculating overall pfs mean, across all ssis

m_pfs_overall <- round(mean(data_youth$pfs_mean, na.rm = TRUE), 2)

```

```{r calculating aggregated pfs mean for abc, include=FALSE}

## Pulling only abc responses

data_youth_abc <- data_youth %>%
  filter(str_detect(ssi_choice, "A.B.C")) # filtering to those who chose abc

## Calculating overall pfs mean for abc

m_pfs_abc <- round(mean(data_youth_abc$pfs_mean, na.rm = TRUE), 2)

```

```{r calculating aggregated pfs mean for care, include=FALSE}

## Pulling only care responses

data_youth_care <- data_youth %>%
  filter(str_detect(ssi_choice, "C.A.R.E")) # filtering to those who chose care

## Calculating overall pfs mean for care

m_pfs_care <- round(mean(data_youth_care$pfs_mean, na.rm = TRUE), 2)

```

```{r calculating aggregated pfs mean for pp, include=FALSE}

## Pulling only pp responses

data_youth_pp <- data_youth %>%
  filter(str_detect(ssi_choice, "Personality")) # filtering to those who chose pp

## Calculating overall pfs mean for pp

m_pfs_pp <- round(mean(data_youth_pp$pfs_mean, na.rm = TRUE), 2)

```

```{r calculating aggregated pfs mean for rise, include=FALSE}

## Pulling only rise responses

data_youth_rise <- data_youth %>%
  filter(str_detect(ssi_choice, "RISE")) # filtering to those who chose rise

## Calculating overall pfs mean for rise

m_pfs_rise <- round(mean(data_youth_rise$pfs_mean, na.rm = TRUE), 2)

```

```{r t test bhs abc, include=FALSE}

library(stats)

## Computing paired t-test

t_abc_bhs <- t.test(data_youth_abc$post_bhs_mean, data_youth_abc$pre_bhs_mean, paired = TRUE)

## Saving p-value for report

abc_bhs_p_value <- t_abc_bhs$p.value

## Saving t-value for effect size calc

abc_bhs_t_value <- t_abc_bhs$statistic

## Saving n pairs for effect size calc 

abc_bhs_n_pairs <- data_youth_abc %>%
  filter(!is.na(post_bhs_mean) & !is.na(pre_bhs_mean)) %>%
  select(post_bhs_mean, pre_bhs_mean) %>%
  nrow()

```

```{r t test effect size bhs abc, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

abc_bhs_dz_value <- round(d.dep.t.diff.t(abc_bhs_t_value, abc_bhs_n_pairs, a = 0.05)$d, 2)

```

```{r t test shs abc, include=FALSE}

library(stats)

## Computing paired t-test

t_abc_shs <- t.test(data_youth_abc$post_shs_mean, data_youth_abc$pre_shs_mean, paired = TRUE)

## Saving p-value for report

abc_shs_p_value <- t_abc_shs$p.value

## Saving t-value for effect size calc

abc_shs_t_value <- t_abc_shs$statistic

## Saving n pairs for effect size calc 

abc_shs_n_pairs <- data_youth_abc %>%
  filter(!is.na(post_shs_mean) & !is.na(pre_shs_mean)) %>%
  select(post_shs_mean, pre_shs_mean) %>%
  nrow()

```

```{r t test effect size shs abc, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

abc_shs_dz_value <- round(d.dep.t.diff.t(abc_shs_t_value, abc_shs_n_pairs, a = 0.05)$d, 2)

```

```{r t test hate abc, include=FALSE}

library(stats)

## Computing paired t-test

t_abc_hate <- t.test(data_youth_abc$post_self_hate_mean, data_youth_abc$pre_self_hate_mean, paired = TRUE)

## Saving p-value for report

abc_hate_p_value <- t_abc_hate$p.value

## Saving t-value for effect size calc

abc_hate_t_value <- t_abc_hate$statistic

## Saving n pairs for effect size calc 

abc_hate_n_pairs <- data_youth_abc %>%
  filter(!is.na(post_self_hate_mean) & !is.na(pre_self_hate_mean)) %>%
  select(post_self_hate_mean, pre_self_hate_mean) %>%
  nrow()

```

```{r t test effect size hate abc, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

abc_hate_dz_value <- round(d.dep.t.diff.t(abc_hate_t_value, abc_hate_n_pairs, a = 0.05)$d, 2)

```

```{r abc effect sizes list, include=FALSE}

## Saving dz values for report

abc_dz_values <- c(abc_bhs_dz_value, abc_shs_dz_value, abc_hate_dz_value)

```

```{r t test bhs care, include=FALSE}

library(stats)

## Computing paired t-test

t_care_bhs <- t.test(data_youth_care$post_bhs_mean, data_youth_care$pre_bhs_mean, paired = TRUE)

## Saving p-value for report

care_bhs_p_value <- t_care_bhs$p.value

## Saving t-value for effect size calc

care_bhs_t_value <- t_care_bhs$statistic

## Saving n pairs for effect size calc 

care_bhs_n_pairs <- data_youth_care %>%
  filter(!is.na(post_bhs_mean) & !is.na(pre_bhs_mean)) %>%
  select(post_bhs_mean, pre_bhs_mean) %>%
  nrow()

```

```{r t test effect size bhs care, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

care_bhs_dz_value <- round(d.dep.t.diff.t(care_bhs_t_value, care_bhs_n_pairs, a = 0.05)$d, 2)

```

```{r t test shs care, include=FALSE}

library(stats)

## Computing paired t-test

t_care_shs <- t.test(data_youth_care$post_shs_mean, data_youth_care$pre_shs_mean, paired = TRUE)

## Saving p-value for report

care_shs_p_value <- t_care_shs$p.value

## Saving t-value for effect size calc

care_shs_t_value <- t_care_shs$statistic

## Saving n pairs for effect size calc 

care_shs_n_pairs <- data_youth_care %>%
  filter(!is.na(post_shs_mean) & !is.na(pre_shs_mean)) %>%
  select(post_shs_mean, pre_shs_mean) %>%
  nrow()

```

```{r t test effect size shs care, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

care_shs_dz_value <- round(d.dep.t.diff.t(care_shs_t_value, care_shs_n_pairs, a = 0.05)$d, 2)

```

```{r t test hate care, include=FALSE}

library(stats)

## Computing paired t-test

t_care_hate <- t.test(data_youth_care$post_self_hate_mean, data_youth_care$pre_self_hate_mean, paired = TRUE)

## Saving p-value for report

care_hate_p_value <- t_care_hate$p.value

## Saving t-value for effect size calc

care_hate_t_value <- t_care_hate$statistic

## Saving n pairs for effect size calc 

care_hate_n_pairs <- data_youth_care %>%
  filter(!is.na(post_self_hate_mean) & !is.na(pre_self_hate_mean)) %>%
  select(post_self_hate_mean, pre_self_hate_mean) %>%
  nrow()

```

```{r t test effect size hate care, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

care_hate_dz_value <- round(d.dep.t.diff.t(care_hate_t_value, care_hate_n_pairs, a = 0.05)$d, 2)

```

```{r care effect sizes list, include=FALSE}

## Saving abc dz values for report

care_dz_values <- c(care_bhs_dz_value, care_hate_dz_value)

```

```{r t test bhs pp, include=FALSE}

library(stats)

## Computing paired t-test

t_pp_bhs <- t.test(data_youth_pp$post_bhs_mean, data_youth_pp$pre_bhs_mean, paired = TRUE)

## Saving p-value for report

pp_bhs_p_value <- t_pp_bhs$p.value

## Saving t-value for effect size calc

pp_bhs_t_value <- t_pp_bhs$statistic

## Saving n pairs for effect size calc 

pp_bhs_n_pairs <- data_youth_pp %>%
  filter(!is.na(post_bhs_mean) & !is.na(pre_bhs_mean)) %>%
  select(post_bhs_mean, pre_bhs_mean) %>%
  nrow()

```

```{r t test effect size bhs pp, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

pp_bhs_dz_value <- round(d.dep.t.diff.t(pp_bhs_t_value, pp_bhs_n_pairs, a = 0.05)$d, 2)

```

```{r t test shs pp, include=FALSE}

library(stats)

## Computing paired t-test

t_pp_shs <- t.test(data_youth_pp$post_shs_mean, data_youth_pp$pre_shs_mean, paired = TRUE)

## Saving p-value for report

pp_shs_p_value <- t_pp_shs$p.value

## Saving t-value for effect size calc

pp_shs_t_value <- t_pp_shs$statistic

## Saving n pairs for effect size calc 

pp_shs_n_pairs <- data_youth_pp %>%
  filter(!is.na(post_shs_mean) & !is.na(pre_shs_mean)) %>%
  select(post_shs_mean, pre_shs_mean) %>%
  nrow()

```

```{r t test effect size shs pp, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

pp_shs_dz_value <- round(d.dep.t.diff.t(pp_shs_t_value, pp_shs_n_pairs, a = 0.05)$d, 2)

```

```{r t test hate pp, include=FALSE}

library(stats)

## Computing paired t-test

t_pp_hate <- t.test(data_youth_pp$post_self_hate_mean, data_youth_pp$pre_self_hate_mean, paired = TRUE)

## Saving p-value for report

pp_hate_p_value <- t_pp_hate$p.value

## Saving t-value for effect size calc

pp_hate_t_value <- t_pp_hate$statistic

## Saving n pairs for effect size calc 

pp_hate_n_pairs <- data_youth_pp %>%
  filter(!is.na(post_self_hate_mean) & !is.na(pre_self_hate_mean)) %>%
  select(post_self_hate_mean, pre_self_hate_mean) %>%
  nrow()

```

```{r t test effect size hate pp, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

pp_hate_dz_value <- round(d.dep.t.diff.t(pp_hate_t_value, pp_hate_n_pairs, a = 0.05)$d, 2)

```

```{r pp effect sizes list, include=FALSE}

## Saving dz values for report

pp_dz_values <- c(pp_bhs_dz_value, pp_shs_dz_value, pp_hate_dz_value)

```

```{r t test bhs rise, include=FALSE}

library(stats)

## Computing paired t-test

t_rise_bhs <- t.test(data_youth_rise$post_bhs_mean, data_youth_rise$pre_bhs_mean, paired = TRUE)

## Saving p-value for report

rise_bhs_p_value <- t_rise_bhs$p.value

## Saving t-value for effect size calc

rise_bhs_t_value <- t_rise_bhs$statistic

## Saving n pairs for effect size calc 

rise_bhs_n_pairs <- data_youth_rise %>%
  filter(!is.na(post_bhs_mean) & !is.na(pre_bhs_mean)) %>%
  select(post_bhs_mean, pre_bhs_mean) %>%
  nrow()

```

```{r t test effect size bhs rise, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

rise_bhs_dz_value <- round(d.dep.t.diff.t(rise_bhs_t_value, rise_bhs_n_pairs, a = 0.05)$d, 2)

```

```{r t test shs rise, include=FALSE}

library(stats)

## Computing paired t-test

t_rise_shs <- t.test(data_youth_rise$post_shs_mean, data_youth_rise$pre_shs_mean, paired = TRUE)

## Saving p-value for report

rise_shs_p_value <- t_rise_shs$p.value

## Saving t-value for effect size calc

rise_shs_t_value <- t_rise_shs$statistic

## Saving n pairs for effect size calc 

rise_shs_n_pairs <- data_youth_rise %>%
  filter(!is.na(post_shs_mean) & !is.na(pre_shs_mean)) %>%
  select(post_shs_mean, pre_shs_mean) %>%
  nrow()

```

```{r t test effect size shs rise, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

rise_shs_dz_value <- round(d.dep.t.diff.t(rise_shs_t_value, rise_shs_n_pairs, a = 0.05)$d, 2)

```

```{r t test hate rise, include=FALSE}

library(stats)

## Computing paired t-test

t_rise_hate <- t.test(data_youth_rise$post_self_hate_mean, data_youth_rise$pre_self_hate_mean, paired = TRUE)

## Saving p-value for report

rise_hate_p_value <- t_rise_hate$p.value

## Saving t-value for effect size calc

rise_hate_t_value <- t_rise_hate$statistic

## Saving n pairs for effect size calc 

rise_hate_n_pairs <- data_youth_rise %>%
  filter(!is.na(post_self_hate_mean) & !is.na(pre_self_hate_mean)) %>%
  select(post_self_hate_mean, pre_self_hate_mean) %>%
  nrow()

```

```{r t test effect size hate rise, include=FALSE}

library(MOTE)

##  Calculating dz effect size, paired t-test

rise_hate_dz_value <- round(d.dep.t.diff.t(rise_hate_t_value, rise_hate_n_pairs, a = 0.05)$d, 3)

```

```{r rise effect sizes list, include=FALSE}

## Saving dz values for report

rise_dz_values <- c(rise_hate_dz_value)

```

```{r, out.width = "350px", out.height = "290px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_lsmh_graphic.png")

```

# Summary

This report uses youth data (under 18) from the largest English-speaking survey among YES data sources (data_id: d09). 

+ Our YES survey was started `r n_started_survey` times
+ `r perc_chose_any_ssi`% of cases chose an SSI after starting the survey (n = `r n_chose_any_ssi`) 

Of the cases where someone chose an SSI:

+ `r perc_chose_abc`% chose ABC
+ `r perc_chose_care`% chose CARE
+ `r perc_chose_pp`% chose Project Personality
+ `r perc_chose_rise`% chose RISE, although this ssi was likely added to the survey later

Of cases where someone started an SSI:

+ `r perc_completed_any_ssi`% of cases completed an SSI (n = `r n_completed_any_ssi`) after starting one (n = `r n_started_any_ssi`)
+ `r perc_completed_abc`% of cases completed ABC (n = `r n_completed_abc`) after starting it (n = `r n_started_abc`)
+ `r perc_completed_care`% of cases completed CARE (n = `r n_completed_care`) after starting it (n = `r n_started_care`)
+ `r perc_completed_pp`% of cases completed Project Personality (n = `r n_completed_pp`) after starting it (n = `r n_started_pp`)
+ `r perc_completed_rise`% of cases completed RISE (n = `r n_completed_rise`) after starting it (n = `r n_started_rise`)

More than half of the time (`r perc_agreed_questionnaires`% of cases), youth agreed to complete optional questionnaires. 

Youth reported SSIs as acceptable, with an overall rating of `r m_pfs_overall` out of 5:

+ ABC received an overall acceptability rating of `r m_pfs_abc` out of 5.
+ CARE received an overall acceptability rating of `r m_pfs_care` out of 5.
+ Project Personality received an overall acceptability rating of `r m_pfs_pp` out of 5.
+ RISE received an overall acceptability rating of `r m_pfs_rise` out of 5.

Of cases with data at both time points:

+ Hopelessness decreased, agency increased, and self-hate decreased pre to post ABC (dzs = `r abc_dz_values`)
+ Hopelessness decreased and self-hate decreased pre to post CARE (dzs = `r care_dz_values`)
+ Hopelessness decreased, agency increased, and self-hate decreased pre to post Project Personality (dzs = `r pp_dz_values`)
+ Significance tests could not be run for RISE, given small n (e.g., df = `r d.dep.t.diff.t(rise_hate_t_value, rise_hate_n_pairs, a = 0.05)$df`)

# Clinical Outcomes 

```{r plot setup, include=FALSE, warning=FALSE}

## Loading required packages

library(tidyverse)
library(ggridges)
library(showtext)

## Setting up fonts

font_add_google(name = "Noto Sans",
                family = "noto sans")

showtext::showtext_auto()

```

## ABC Project

```{r, out.width = "260px", out.height = "250px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_abc_graphic.png")

```

Conducting a paired t-test to evaluate pre vs post-abc changes in hopelessness (bhs scores). For those who chose the abc intervention with data at both time points, hopelessness decreased from pre to post abc, dz = `r abc_bhs_dz_value`.

```{r t test results abc bhs}

t_abc_bhs

```

```{r t test effect size abc bhs}

abc_bhs_dz_value

```

```{r visualizing pre-post bhs abc setup, include=FALSE}

## Selecting pre and post vars for abc

pre_post_bhs_abc <- data_youth %>% 
  filter(str_detect(ssi_started, "A.B.C.")) %>%
  dplyr::select(pre_bhs_mean, post_bhs_mean)

# Converting to long data format

pre_post_bhs_abc_long <- pivot_longer(pre_post_bhs_abc, 
                                           cols = contains("mean"), 
                                           names_to = "timing", 
                                           values_to = "hopelessness")

##  Renaming for plot

plot_data_bhs_abc <- pre_post_bhs_abc_long %>% 
  mutate(timing = case_when(str_detect(timing, "pre") ~ "Before",
         str_detect(timing, "post") ~ "After",
         is.na(timing) ~ NA_character_))

```

```{r writing plot function for future plots, include=FALSE}

## Writing a function for future plot setup

process_plot_data <- function(data, ssi_string, pre_var, post_var, outcome_label) {
  # Select pre and post variables based on the ssi string
  pre_post_outcome <- data_youth %>%
    filter(str_detect(ssi_started, ssi_string)) %>%
    dplyr::select(contains(pre_var), 
                  contains(post_var))
  
  # Convert to long data format
  pre_post_outcome_long <- pre_post_outcome %>%
    pivot_longer(cols = contains("mean"), 
                 names_to = "timing", 
                 values_to = outcome_label)
  
  # Mutate 'timing' to label pre/post as 'Before'/'After'
  plot_data <- pre_post_outcome_long %>%
    mutate(timing = case_when(
      str_detect(timing, "pre") ~ "Before",
      str_detect(timing, "post") ~ "After",
      is.na(timing) ~ NA_character_
    ))
  
  return(plot_data)
}

```

```{r running custom plot function on abc bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_abc_function <- process_plot_data(data_youth, "A.B.C.", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r checking data frames are identical with and without function, include=FALSE}

identical(plot_data_bhs_abc, plot_data_bhs_abc_function) # true if processed data is identical using function

```

```{r visualizing pre-post bhs abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_bhs <- plot_data_bhs_abc_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(0, 3)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post abc

```{r plotting bhs pre and post abc, warning=FALSE, message=FALSE}

plot_abc_bhs

```

Conducting a paired t-test to evaluate pre vs post-abc changes in agency (shs pathways scores). For those who chose the abc intervention with data at both time points, agencyincreased from pre to post abc, dz = `r abc_shs_dz_value`.

```{r t test results abc shs}

t_abc_shs

```

```{r t test effect size abc shs}

abc_shs_dz_value

```

```{r running custom plot function on abc shs data, include=FALSE}

## Running plot setup function

plot_data_shs_abc_function <- process_plot_data(data_youth, "A.B.C.", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_shs <- plot_data_shs_abc_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(1, 8)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Agency", y = " ")

```

Plotting agency pre and post abc

```{r plotting shs pre and post abc, warning=FALSE, message=FALSE}

plot_abc_shs

```

Conducting a paired t-test to evaluate pre vs post-abc changes in self-hate (self-hate scale scores). For those who chose the abc intervention with data at both time points, self-hate decreased from pre to post abc, dz = `r abc_hate_dz_value`.

```{r t test results abc hate}

t_abc_hate

```

```{r t test effect size abc hate}

abc_hate_dz_value

```

```{r running custom plot function on abc hate data, include=FALSE}

## Running plot setup function

plot_data_hate_abc_function <- process_plot_data(data_youth, "A.B.C.", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate abc, include=FALSE, warning=FALSE}

## Plotting

plot_abc_hate <- plot_data_hate_abc_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#32A2A0", "grey")) +
  scale_color_manual(values = c("#32A2A0", "grey")) +
  scale_x_continuous(limits = c(1, 7)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post abc

```{r plotting hate pre and post abc, warning=FALSE, message=FALSE}

plot_abc_hate

```

Combining all abc pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after abc; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after abc; right plot shows distributions of self-hate scores before and after abc. Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining abc pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for abc

plots_abc <- plot_abc_bhs + plot_abc_shs + plot_abc_hate +
  plot_annotation(title = "Outcomes before vs after ABC Project",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_abc

```

## Project CARE

```{r, out.width = "260px", out.height = "250px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_care_graphic.png")

```

Conducting a paired t-test to evaluate pre vs post-care changes in hopelessness (bhs scores). For those who chose the care intervention with data at both time points, hopelessness decreased from pre to post care, dz = `r care_bhs_dz_value`.

```{r t test results care bhs}

t_care_bhs

```

```{r t test effect size care bhs}

care_bhs_dz_value

```

```{r running custom plot function on care bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_care_function <- process_plot_data(data_youth, "C.A.R.E", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs care, include=FALSE, warning=FALSE}

## Plotting

plot_care_bhs <- plot_data_bhs_care_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(0, 3)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post care

```{r plotting bhs pre and post care, warning=FALSE, message=FALSE}

plot_care_bhs

```

Conducting a paired t-test to evaluate pre vs post-care changes in agency (shs pathways scores). For those who chose the care intervention with data at both time points, we detect no significant change in agency from pre to post care, dz = `r care_shs_dz_value`.

```{r t test results care shs}

t_care_shs

```

```{r t test effect size care shs}

care_shs_dz_value

```

```{r running custom plot function on care shs data, include=FALSE}

## Running plot setup function

plot_data_shs_care_function <- process_plot_data(data_youth, "C.A.R.E", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs care, include=FALSE, warning=FALSE}

## Plotting

plot_care_shs <- plot_data_shs_care_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(1, 8)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Agency", y = " ")

```

Plotting agency pre and post care

```{r plotting shs pre and post care, warning=FALSE, message=FALSE}

plot_care_shs

```

Conducting a paired t-test to evaluate pre vs post-care changes in self-hate (self-hate scale scores). For those who chose the care intervention with data at both time points, self-hate decreased from pre to post care, dz = `r abc_hate_dz_value`.

```{r t test results care hate}

t_care_hate

```

```{r t test effect size care hate}

care_hate_dz_value

```

```{r running custom plot function on care hate data, include=FALSE}

## Running plot setup function

plot_data_hate_care_function <- process_plot_data(data_youth, "C.A.R.E", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate care, include=FALSE, warning=FALSE}

## Plotting

plot_care_hate <- plot_data_hate_care_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#A52B4D", "grey")) +
  scale_color_manual(values = c("#A52B4D", "grey")) +
  scale_x_continuous(limits = c(1, 7)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post care

```{r plotting hate pre and post care, warning=FALSE, message=FALSE}

plot_care_hate

```

Combining all project care pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project care; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project care; right plot shows distributions of self-hate scores before and after project care. Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining care pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for care

plots_care <- plot_care_bhs + plot_care_shs + plot_care_hate +
  plot_annotation(title = "Outcomes before vs after Project CARE",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_care

```

## Project Personality

```{r, out.width = "260px", out.height = "240px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_pp_graphic.png")

```

Conducting a paired t-test to evaluate pre vs post-project personality changes in hopelessness (bhs scores). For those who chose the project personality intervention with data at both time points, hopelessness decreased from pre to post project personality, dz = `r pp_bhs_dz_value`.

```{r t test results pp bhs}

t_pp_bhs

```

```{r t test effect size pp bhs}

pp_bhs_dz_value

```

```{r running custom plot function on pp bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_pp_function <- process_plot_data(data_youth, "Personality", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_bhs <- plot_data_bhs_pp_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(0, 3)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post project personality

```{r plotting bhs pre and post pp, warning=FALSE, message=FALSE}

plot_pp_bhs

```

Conducting a paired t-test to evaluate pre vs post-project personality changes in agency (shs pathways scores). For those who chose the project personality intervention with data at both time points, agency increased from pre to post project personality, dz = `r pp_shs_dz_value`.

```{r t test results pp shs}

t_pp_shs

```

```{r t test effect size pp shs}

pp_shs_dz_value

```

```{r running custom plot function on pp shs data, include=FALSE}

## Running plot setup function

plot_data_shs_pp_function <- process_plot_data(data_youth, "Personality", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_shs <- plot_data_shs_pp_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(1, 8)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Agency", y = " ")

```

Plotting agency pre and post project personality

```{r plotting shs pre and post pp, warning=FALSE, message=FALSE}

plot_pp_shs

```

Conducting a paired t-test to evaluate pre vs post-project personality changes in self-hate (self-hate scale scores). For those who chose the project personality intervention with data at both time points, self-hate decreased from pre to post project personality, dz = `r pp_hate_dz_value`.

```{r t test results pp hate}

t_pp_hate

```

```{r t test effect size pp hate}

pp_hate_dz_value

```

```{r running custom plot function on pp hate data, include=FALSE}

## Running plot setup function

plot_data_hate_pp_function <- process_plot_data(data_youth, "Personality", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate pp, include=FALSE, warning=FALSE}

## Plotting

plot_pp_hate <- plot_data_hate_pp_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#3F9CF5", "grey")) +
  scale_color_manual(values = c("#3F9CF5", "grey")) +
  scale_x_continuous(limits = c(1, 7)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post project personality

```{r plotting hate pre and post pp, warning=FALSE, message=FALSE}

plot_pp_hate

```

Combining all project personality pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project personality; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project personality; right plot shows distributions of self-hate scores before and after project personality Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining pp pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for pp

plots_pp <- plot_pp_bhs + plot_pp_shs + plot_pp_hate +
  plot_annotation(title = "Outcomes before vs after Project Personality",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_pp

```

## Project RISE

```{r, out.width = "260px", out.height = "240px", include=TRUE, echo=FALSE}

knitr::include_graphics("/Users/mallorydobias/Documents/R/yes_project/images/yes_rise_graphic.png")

```

Conducting a paired t-test to evaluate pre vs post-rise changes in hopelessness (bhs scores). For those who chose the rise intervention with data at both time points, we find no evidence that hopelessness decreased from pre to post rise, dz = `r rise_bhs_dz_value`. However, this test is currently run in a very small sample size (df = `r d.dep.t.diff.t(rise_hate_t_value, rise_hate_n_pairs, a = 0.05)$df`).

```{r t test results rise bhs}

t_rise_bhs

```

```{r t test effect size rise bhs}

rise_bhs_dz_value

```

```{r running custom plot function on rise bhs data, include=FALSE}

## Running plot setup function

plot_data_bhs_rise_function <- process_plot_data(data_youth, "RISE", "pre_bhs_mean", "post_bhs_mean", "hopelessness")

```

```{r visualizing pre-post bhs rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_bhs <- plot_data_bhs_rise_function %>%
  ggplot(aes(x = hopelessness, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(0, 3)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Hopelessness", y = " ")

```

Plotting hopelessness pre and post project rise

```{r plotting bhs pre and post rise, warning=FALSE, message=FALSE}

plot_rise_bhs

```

Conducting a paired t-test to evaluate pre vs post-rise changes in agency (shs pathways scores). For those who chose the rise intervention with data at both time points, we find no evidence that agency increased from pre to post rise, dz = `r rise_shs_dz_value`. However, this test is currently run in a very small sample size (df = `r d.dep.t.diff.t(rise_hate_t_value, rise_hate_n_pairs, a = 0.05)$df`).

```{r t test results rise shs}

t_rise_shs

```

```{r t test effect size rise shs}

rise_shs_dz_value

```

```{r running custom plot function on rise shs data, include=FALSE}

## Running plot setup function

plot_data_shs_rise_function <- process_plot_data(data_youth, "RISE", "pre_shs_mean", "post_shs_mean", "hope")

```

```{r visualizing pre-post shs rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_shs <- plot_data_shs_rise_function %>%
  ggplot(aes(x = hope, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(1, 8)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Agency", y = " ")

```

Plotting agency pre and post project rise

```{r plotting shs pre and post rise, warning=FALSE, message=FALSE}

plot_rise_shs

```

Conducting a paired t-test to evaluate pre vs post-rise changes in self-hate (self-hate scale scores). For those who chose the rise intervention with data at both time points, self-hate decreased from pre to post rise, dz = `r rise_hate_dz_value`. However, we should probably not pay attention to the results of this test for now, given the very small sample size (df = `r d.dep.t.diff.t(rise_hate_t_value, rise_hate_n_pairs, a = 0.05)$df`). 

```{r t test results rise hate}

t_rise_hate

```

```{r t test effect size rise hate}

rise_hate_dz_value

```

```{r running custom plot function on rise hate data, include=FALSE}

## Running plot setup function

plot_data_hate_rise_function <- process_plot_data(data_youth, "RISE", "pre_self_hate_mean", "post_self_hate_mean", "hate")

```

```{r visualizing pre-post hate rise, include=FALSE, warning=FALSE}

## Plotting

plot_rise_hate <- plot_data_hate_rise_function %>%
  ggplot(aes(x = hate, y = timing, fill = timing, color = timing)) +
  geom_density_ridges(alpha = 0.4,
                      jittered_points = TRUE,
                      position = "raincloud") +
  scale_fill_manual(values = c("#F48151", "grey")) +
  scale_color_manual(values = c("#F48151", "grey")) +
  scale_x_continuous(limits = c(1, 7)) +  # Set x-axis limits
  theme_light() +
  theme(legend.position = "none",
        text = element_text(family = "noto sans"),
        title = element_text(size = 10),
        plot.background = element_rect(fill = "white")) +
  labs(x = "Self-Hate", y = " ")

```

Plotting self-hate pre and post project rise

```{r plotting hate pre and post rise, warning=FALSE, message=FALSE}

plot_rise_hate

```

Combining all project rise pre-post outcomes into one plot. Left plot shows distributions of hopelessness scores (BHS scale) before and after project rise; middle plot shows distributions of pathway scores (SHS scale, pathways subscale) before and after project rise; right plot shows distributions of self-hate scores before and after project rise Within each plot, higher scores (i.e., further to the right) reflect more hopelessness, hope, and self-hate respectively.

```{r combining rise pre post outcomes plots, warning=FALSE, message=FALSE}

## Plotting all pre post outcomes for rise

plots_rise <- plot_rise_bhs + plot_rise_shs + plot_rise_hate +
  plot_annotation(title = "Outcomes before vs after Project RISE",
                  theme = theme(plot.title = element_text(hjust = 0.5)))

plots_rise

```

## All

```{r combining all pre post outcomes plots, warning=FALSE, message=FALSE}

library(patchwork)

# Combine the plots vertically
plots_all <- plots_abc / plots_care / plots_pp / plots_rise  + 
  plot_annotation(
    title = "Outcomes before and after all SSIs",
    caption = "hopelessness, hope, self-hate before + after ABC (green), CARE (red), Project Personality (blue), and RISE (orange)"
  )

# Show the combined plot
plots_all

```

# SSI Completion

## ABC Project

Of `r n_started_abc` cases where someone started abc, `r n_completed_abc` cases completed the intervention. This results in an abc completion rate of `r perc_completed_abc`%.

```{r n started abc}

n_started_abc

```

```{r n completed abc}

n_completed_abc

```

```{r perc completed abc}

perc_completed_abc

```

## Project CARE

Of `r n_started_care` cases where someone started care, `r n_completed_care` cases completed the intervention. This results in an project care completion rate of `r perc_completed_care`%.

```{r n started care}

n_started_care

```

```{r n completed care}

n_completed_care

```

```{r perc completed care}

perc_completed_care

```

## Project Personality

Of `r n_started_pp` cases where someone started project personality, `r n_completed_pp` cases completed the intervention. This results in a project personality completion rate of `r perc_completed_pp`%.

```{r n started pp}

n_started_pp

```

```{r n completed pp}

n_completed_pp

```

```{r perc completed pp}

perc_completed_pp

```

## Project RISE

Of `r n_started_rise` cases where someone started project rise, `r n_completed_rise` cases completed the intervention. This results in a project rise completion rate of `r perc_completed_rise`%.

```{r n started rise}

n_started_rise

```

```{r n completed rise}

n_completed_rise

```

```{r perc completed rise}

perc_completed_rise

```

## All

Of `r n_started_any_ssi` cases where someone started any ssi, `r n_completed_any_ssi` cases completed the intervention. This results in an overall completion rate of `r perc_completed_any_ssi`% for any ssi.

```{r n started any ssi}

n_started_any_ssi

```

```{r n completed any ssi}

n_completed_any_ssi

```

```{r perc completed any ssi}

perc_completed_any_ssi

```

# Questionnaire Completion

Around half of the time (`r perc_agreed_questionnaires` %), youth agreed to fill out optional questionnaires.

```{r perc agreed questionnaires}

perc_agreed_questionnaires

```

# Acceptability

## All

```{r calculating pfs item means across all ssis, include=FALSE}

## Calculating individual pfs item means, across all ssis

summary_pfs_enjoyed <- data_youth %>%
  summarize(mean_value = round(mean(pfs_1, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_1, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "enjoyed",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_understood <- data_youth %>%
  summarize(mean_value = round(mean(pfs_2, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_2, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "understood",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_easy <- data_youth %>%
  summarize(mean_value = round(mean(pfs_3, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_3, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "easy to use",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_tried <- data_youth %>%
  summarize(mean_value = round(mean(pfs_4, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_4, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "tried my hardest",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_helpful <- data_youth %>%
  summarize(mean_value = round(mean(pfs_5, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_5, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "helpful for others",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_recommend <- data_youth %>%
  summarize(mean_value = round(mean(pfs_6, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_6, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "recommend to others",
         mean_value = mean_value,
         sd_value = sd_value)

summary_pfs_agree <- data_youth %>%
  summarize(mean_value = round(mean(pfs_7, na.rm = TRUE), 2),
            sd_value = round(sd(pfs_7, na.rm = TRUE), 2)) %>%
  mutate(pfs_item = "agree with message",
         mean_value = mean_value,
         sd_value = sd_value)

```

```{r pulling pfs item means across all ssis into one df, include=FALSE}

## Pulling into one data frame

summary_pfs_overall <- dplyr::bind_rows(
  summary_pfs_enjoyed, summary_pfs_understood, summary_pfs_easy,
  summary_pfs_tried, summary_pfs_helpful, summary_pfs_recommend,
  summary_pfs_agree) %>%
  select(pfs_item, mean = mean_value, sd = sd_value)

```

Overall PFS scale item descriptives across all SSIs

```{r printing overall pfs item descriptives across all ssis}

summary_pfs_overall

```

```{r creating custom function to calculate pfs item descriptives, include=FALSE}

## I'll use this function to calculate pfs item descriptives for each ssi

# Define the function
calculate_pfs_item_means <- function(data) {
  
  # Create a list of variable names and their corresponding item descriptions
  pfs_items <- list(
    pfs_1 = "enjoyed",
    pfs_2 = "understood",
    pfs_3 = "easy to use",
    pfs_4 = "tried my hardest",
    pfs_5 = "helpful for others",
    pfs_6 = "recommend to others",
    pfs_7 = "agree with message"
  )
  
  # Initialize an empty list to store the summaries
  summaries <- list()
  
  # Loop through each item and calculate the mean and sd
  for (pfs in names(pfs_items)) {
    summary <- data %>%
      summarize(mean_value = round(mean(.data[[pfs]], na.rm = TRUE), 2),
                sd_value = round(sd(.data[[pfs]], na.rm = TRUE), 2)) %>%
      mutate(pfs_item = pfs_items[[pfs]],
             mean_value = mean_value,
             sd_value = sd_value)
    
    summaries[[pfs]] <- summary
  }
  
  # Combine all summaries into a single data frame
  summary_pfs_overall <- bind_rows(summaries) %>%
    select(pfs_item, mean = mean_value, sd = sd_value)
  
  return(summary_pfs_overall)
}

```

```{r testing custom pfs function, include=FALSE}

# Testing with overall data_youth dataset
summary_pfs_overall_function <- calculate_pfs_item_means(data_youth)

# Print the overall PFS item descriptives
summary_pfs_overall_function

# Checking if this works
identical(summary_pfs_overall, summary_pfs_overall_function) # true if results are identical with and without function

```

## ABC Project

PFS scale item descriptives for abc

```{r pfs item desctiptives for abc}

## Running custom function to get pfs item descriptives 

summary_pfs_abc <- calculate_pfs_item_means(data_youth_abc)

## Print descriptives

summary_pfs_abc

```

## Project CARE

PFS scale item descriptives for care

```{r pfs item desctiptives for care}

## Running custom function to get pfs item descriptives 

summary_pfs_care <- calculate_pfs_item_means(data_youth_care)

## Print descriptives

summary_pfs_care

```

## Project Personality

PFS scale item descriptives for project personality

```{r pfs item desctiptives for pp}

## Running custom function to get pfs item descriptives 

summary_pfs_pp <- calculate_pfs_item_means(data_youth_pp)

## Print descriptives

summary_pfs_pp

```

## Project RISE

PFS scale item descriptives for rise

```{r pfs item desctiptives for rise}

## Running custom function to get pfs item descriptives 

summary_pfs_rise <- calculate_pfs_item_means(data_youth_rise)

## Print descriptives

summary_pfs_rise

```